CREATE OR REPLACE PROCEDURE StoredProc()

RETURNS VARCHAR NOT NULL

LANGUAGE JAVASCRIPT

EXECUTE AS CALLER

AS

$$

var my_sql_command ="CREATE OR REPLACE DATABASE STORED_PROCEDURE";

snowflake.createStatement({sqlText:my_sql_command}).execute();

var my_sql_command1 ="CREATE OR REPLACE SCHEMA external_staging";

snowflake.createStatement({sqlText:my_sql_command1}).execute();

snowflake.createStatement({sqlText:`CREATE OR REPLACE STAGE AWSD url='s3://my-aws-s3-bucket-vdasari21/ProjectFiles/Final_NBA_Data.csv'
credentials=(aws_key_id='AKIA6GGA6CPUIBU6MHFI' aws_secret_key='g72dnWed5ynipkKA2GBd45bJvWQGW3OY0sX55PCi');`}).execute();

snowflake.createStatement({sqlText:`create or replace table nba_player_stats ( 
    PLAYER_ID INT,
    RANK INT,
    PLAYER VARCHAR,
    TEAM_ID BIGINT,
    TEAM VARCHAR,
    GP FLOAT, 
    MIN	FLOAT,
    FGM	FLOAT,
    FGA	FLOAT,
    FG_PCT FLOAT,	
    FG3M FLOAT,	
    FG3A FLOAT,	
    FG3_PCT	FLOAT,
    FTM	float,
    FTA	float,
    FT_PCT FLOAT,	
    OREB FLOAT,	
    DREB FLOAT,	
    REB	FLOAT,
    AST	FLOAT,
    STL	FLOAT,
    BLK	FLOAT,
    TOV	FLOAT,
    PTS	FLOAT,
    EFF FLOAT
);`}).execute();

snowflake.createStatement({sqlText:`copy into nba_player_stats from 
@STAGINGS.EXTERNAL_STAGING.AWS file_format = (type='csv' field_delimiter=',' skip_header=1);`}).execute();

return "Success";

$$;

#Retrieve all data from the table
SELECT * FORM nba_player_stats;


1. We have created a stored procedure with name "StoredProc"
2. This stored procedure returns a string VARCHAR
3. We have given caller rights for this stored procedure
4. In the above stored procedure, we have done the following:
    1. Created Database STORED_PROCEDURE
    2. Created Schema external_staging
    3. Created Stage with AWS s3 
    4. Created table nba_player_stats with columns matching the data in S3.
    5. Copied data from stage into table 
    6. Retrieve data from the table 
